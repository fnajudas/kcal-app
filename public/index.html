<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kcal Calculator - Hitung Kebutuhan Kalori Harianmu</title>

    <!-- PWA Meta Tags -->
    <meta name="description"
        content="Aplikasi kalkulator kalori harian untuk diet dan kesehatan. Hitung BMI, TDEE, dan track makanan harianmu.">
    <meta name="theme-color" content="#2ecc71">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="KcalCalc">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <button id="theme-toggle" class="btn-icon theme-toggle" title="Toggle Dark Mode">
                    <svg id="theme-icon-sun" class="theme-icon" xmlns="http://www.w3.org/2000/svg" width="20"
                        height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                    <svg id="theme-icon-moon" class="theme-icon" xmlns="http://www.w3.org/2000/svg" width="20"
                        height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        style="display: none;">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                </button>
            </div>
            <h1>Kcal Calculator</h1>
            <p class="subtitle">Hitung BMI & Kebutuhan Kalori Harianmu</p>
        </header>

        <!-- Profile Section -->
        <section id="profile-section" class="card">
            <div class="card-header">
                <h2>Profil Kamu</h2>
                <button id="edit-profile-btn" class="btn-icon" title="Edit Profil" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </button>
            </div>

            <!-- Profile Form -->
            <form id="profile-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="gender">Jenis Kelamin</label>
                        <select id="gender" required>
                            <option value="">Pilih...</option>
                            <option value="male">Pria</option>
                            <option value="female">Wanita</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="age">Umur (tahun)</label>
                        <input type="number" id="age" min="10" max="120" placeholder="25" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="height">Tinggi Badan (cm)</label>
                        <input type="number" id="height" min="100" max="250" placeholder="170" required>
                    </div>
                    <div class="form-group">
                        <label for="weight">Berat Badan (kg)</label>
                        <input type="number" id="weight" min="30" max="300" step="0.1" placeholder="65" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="activity">Level Aktivitas</label>
                    <select id="activity" required>
                        <option value="">Pilih level aktivitas...</option>
                        <option value="1.2">Sedentary - Tidak aktif / kerja kantoran</option>
                        <option value="1.375">Light - Olahraga ringan 1-3x/minggu</option>
                        <option value="1.55">Moderate - Olahraga 3-5x/minggu</option>
                        <option value="1.725">Active - Olahraga 6-7x/minggu</option>
                        <option value="1.9">Very Active - Olahraga berat / atlet</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-primary">Hitung Kebutuhan Kalori</button>
            </form>

            <!-- Profile Display (shown after form submitted) -->
            <div id="profile-display" class="profile-display" style="display: none;">
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-label">Jenis Kelamin</span>
                        <span class="stat-value" id="display-gender">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Umur</span>
                        <span class="stat-value" id="display-age">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Tinggi</span>
                        <span class="stat-value" id="display-height">-</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Berat</span>
                        <span class="stat-value" id="display-weight">-</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Section (hidden until profile is set) -->
        <section id="results-section" class="card" style="display: none;">
            <h2>Hasil Perhitungan</h2>

            <div class="results-grid">
                <!-- BMI Card -->
                <div class="result-card">
                    <div class="result-icon bmi-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"></path>
                            <path d="M12 6v6l4 2"></path>
                        </svg>
                    </div>
                    <div class="result-info">
                        <span class="result-label">BMI Kamu</span>
                        <span class="result-value" id="bmi-value">-</span>
                        <span class="result-category" id="bmi-category">-</span>
                    </div>
                </div>

                <!-- Daily Calorie Card -->
                <div class="result-card">
                    <div class="result-icon calorie-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2">
                            <path d="M12 2c.5 4-2 6-2 10a4 4 0 1 0 8 0c0-4-2.5-6-2-10"></path>
                            <path d="M12 22v-4"></path>
                        </svg>
                    </div>
                    <div class="result-info">
                        <span class="result-label">TDEE (Maintenance)</span>
                        <span class="result-value" id="tdee-value">-</span>
                        <span class="result-category">kcal/hari</span>
                    </div>
                </div>
            </div>

            <!-- Ideal Weight Card -->
            <div class="ideal-weight-card" id="ideal-weight-card">
                <div class="ideal-weight-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path d="M12 3v18"></path>
                        <path d="M5 8l7-5 7 5"></path>
                        <path d="M5 16l7 5 7-5"></path>
                    </svg>
                </div>
                <div class="ideal-weight-content">
                    <span class="ideal-weight-label">Berat Badan Ideal untuk Tinggi <span id="ideal-height">-</span>
                        cm</span>
                    <span class="ideal-weight-value"><span id="ideal-weight-min">-</span> - <span
                            id="ideal-weight-max">-</span> kg</span>
                    <span class="ideal-weight-diff" id="weight-diff-message"></span>
                </div>
            </div>

            <!-- BMI Scale -->
            <div class="bmi-scale">
                <div class="scale-bar">
                    <div class="scale-segment underweight">Underweight</div>
                    <div class="scale-segment normal">Normal</div>
                    <div class="scale-segment overweight">Overweight</div>
                    <div class="scale-segment obese">Obese</div>
                </div>
                <div class="scale-indicator" id="bmi-indicator"></div>
            </div>
        </section>

        <!-- Goal Setting Section -->
        <section id="goal-section" class="card" style="display: none;">
            <h2>Target & Goal</h2>

            <form id="goal-form">
                <div class="form-group">
                    <label for="goal-type">Tujuan Kamu</label>
                    <select id="goal-type" required>
                        <option value="maintenance">Jaga Berat Badan (Maintenance)</option>
                        <option value="mild-deficit">Turun Perlahan (-0.25 kg/minggu)</option>
                        <option value="deficit">Turun Berat (-0.5 kg/minggu)</option>
                        <option value="aggressive-deficit">Turun Cepat (-0.75 kg/minggu)</option>
                        <option value="mild-surplus">Naik Perlahan (+0.25 kg/minggu)</option>
                        <option value="surplus">Naik Berat (+0.5 kg/minggu)</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="target-weight">Target Berat Badan (kg)</label>
                        <input type="number" id="target-weight" min="30" max="200" step="0.1" placeholder="60">
                    </div>
                    <div class="form-group">
                        <label for="custom-calories">Kalori Custom (opsional)</label>
                        <input type="number" id="custom-calories" min="1000" max="5000" placeholder="Auto">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Simpan Goal</button>
            </form>

            <!-- Goal Display -->
            <div id="goal-display" class="goal-display" style="display: none;">
                <div class="goal-info-card">
                    <div class="goal-target">
                        <span class="goal-label">Target Kalori Harian</span>
                        <span class="goal-value" id="display-target-calories">-</span>
                        <span class="goal-unit">kcal</span>
                    </div>
                    <div class="goal-details">
                        <div class="goal-detail-item">
                            <span>Target Berat:</span>
                            <strong id="display-target-weight">-</strong>
                        </div>
                        <div class="goal-detail-item">
                            <span>Estimasi Waktu:</span>
                            <strong id="display-goal-time">-</strong>
                        </div>
                        <div class="goal-detail-item">
                            <span>Target Tercapai:</span>
                            <strong id="display-goal-date">-</strong>
                        </div>
                    </div>
                </div>
                <button id="edit-goal-btn" class="btn btn-secondary btn-small">Edit Goal</button>
            </div>
        </section>

        <!-- Dashboard Section (hidden until profile is set) -->
        <section id="dashboard-section" class="card" style="display: none;">
            <div class="card-header">
                <h2>Dashboard Hari Ini</h2>
                <span class="date-display" id="current-date">-</span>
            </div>

            <div class="dashboard-grid">
                <!-- Calorie Progress -->
                <div class="dashboard-item calorie-progress">
                    <h3>Kalori</h3>
                    <div class="progress-circle">
                        <svg class="progress-ring" width="150" height="150">
                            <circle class="progress-ring-bg" cx="75" cy="75" r="65" />
                            <circle class="progress-ring-fill" cx="75" cy="75" r="65" id="progress-ring" />
                        </svg>
                        <div class="progress-text">
                            <span class="consumed-value" id="consumed-calories">0</span>
                            <span class="consumed-label">dari <span id="target-calories">0</span></span>
                        </div>
                    </div>
                    <div class="progress-stats">
                        <div class="stat-box">
                            <span class="stat-number remaining" id="remaining-calories">0</span>
                            <span class="stat-desc">Sisa</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-number percentage" id="percentage-consumed">0%</span>
                            <span class="stat-desc">Tercapai</span>
                        </div>
                    </div>
                </div>

                <!-- Water Progress -->
                <div class="dashboard-item water-progress">
                    <h3>Air Minum</h3>
                    <div class="water-display">
                        <div class="water-icon">ðŸ’§</div>
                        <div class="water-count">
                            <span id="water-current">0</span>
                            <span class="water-divider">/</span>
                            <span id="water-target">8</span>
                            <span class="water-unit">gelas</span>
                        </div>
                        <div class="water-ml">(<span id="water-ml">0</span> ml)</div>
                    </div>
                    <div class="water-buttons">
                        <button id="water-minus" class="btn-circle btn-minus">-</button>
                        <button id="water-plus" class="btn-circle btn-plus">+</button>
                    </div>
                    <div class="water-bar">
                        <div class="water-bar-fill" id="water-bar-fill"></div>
                    </div>
                </div>
            </div>

            <!-- Status Message -->
            <div class="status-message" id="status-message">
                <span class="status-icon">ðŸ’ª</span>
                <span class="status-text">Mulai catat makananmu!</span>
            </div>
        </section>

        <!-- Food Tracker Section -->
        <section id="food-section" class="card" style="display: none;">
            <div class="card-header">
                <h2>Catat Makanan</h2>
                <button id="show-templates-btn" class="btn btn-secondary btn-small">Template</button>
            </div>

            <!-- Meal Templates (hidden by default) -->
            <div id="templates-panel" class="templates-panel" style="display: none;">
                <div class="templates-header">
                    <h3>Meal Templates</h3>
                    <button id="save-as-template-btn" class="btn btn-success btn-small">Simpan Hari Ini sebagai
                        Template</button>
                </div>
                <div id="templates-list" class="templates-list">
                    <p class="empty-message">Belum ada template tersimpan.</p>
                </div>
            </div>

            <!-- Food Input Form -->
            <form id="food-form" class="food-form">
                <div class="form-row">
                    <div class="form-group flex-2">
                        <label for="food-name">Nama Makanan</label>
                        <div class="autocomplete-wrapper">
                            <input type="text" id="food-name" placeholder="Ketik nama makanan..." autocomplete="off"
                                required>
                            <ul id="food-suggestions" class="autocomplete-list"></ul>
                        </div>
                        <small class="input-hint" id="food-hint"></small>
                    </div>
                    <div class="form-group flex-1">
                        <label for="food-calories">Kalori (kcal)</label>
                        <input type="number" id="food-calories" min="1" max="5000" placeholder="350" required>
                        <small class="input-hint calorie-hint" id="calorie-hint">Bisa diedit</small>
                    </div>
                </div>
                <button type="submit" class="btn btn-success">+ Tambah Makanan</button>
            </form>

            <!-- Food List -->
            <div class="food-list-container">
                <h3>Makanan Hari Ini</h3>
                <ul id="food-list" class="food-list">
                </ul>
                <p id="empty-food-message" class="empty-message">Belum ada makanan yang dicatat.</p>
            </div>

            <button id="clear-foods-btn" class="btn btn-danger" style="display: none;">
                Hapus Semua Makanan
            </button>
        </section>

        <!-- Food Generator Section -->
        <section id="generator-section" class="card" style="display: none;">
            <div class="card-header">
                <h2>Generator Makanan</h2>
                <span class="generator-badge">Beta</span>
            </div>
            <p class="section-description">Cari rekomendasi makanan berdasarkan kalori dan budget.</p>

            <!-- Generator Form -->
            <form id="generator-form" class="generator-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="gen-target-calories">Target Kalori (kcal)</label>
                        <input type="number" id="gen-target-calories" min="50" max="2000" placeholder="500" required>
                    </div>
                    <div class="form-group">
                        <label for="gen-tolerance">Toleransi (%)</label>
                        <select id="gen-tolerance">
                            <option value="10">Â± 10%</option>
                            <option value="20" selected>Â± 20%</option>
                            <option value="30">Â± 30%</option>
                            <option value="50">Â± 50%</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="gen-budget-min">Budget Min (Rp)</label>
                        <input type="number" id="gen-budget-min" min="0" step="1000" placeholder="5000">
                    </div>
                    <div class="form-group">
                        <label for="gen-budget-max">Budget Max (Rp)</label>
                        <input type="number" id="gen-budget-max" min="0" step="1000" placeholder="30000">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Generate Rekomendasi</button>
            </form>

            <!-- Generator Results -->
            <div id="generator-results" class="generator-results" style="display: none;">
                <div class="generator-results-header">
                    <h3>Hasil Rekomendasi</h3>
                    <div class="generator-actions">
                        <button id="select-all-foods" class="btn btn-secondary btn-small">Pilih Semua</button>
                        <button id="clear-selection" class="btn btn-secondary btn-small">Hapus Pilihan</button>
                    </div>
                </div>
                <div class="generator-summary" id="generator-summary">
                    <span id="gen-result-count">0 makanan ditemukan</span>
                    <span id="gen-selected-count">0 dipilih</span>
                    <span id="gen-selected-calories">0 kcal</span>
                    <span id="gen-selected-price">Rp 0</span>
                </div>
                <ul id="generator-list" class="generator-list">
                    <!-- Generated by JS -->
                </ul>
                <p id="generator-empty" class="empty-message" style="display: none;">
                    Tidak ada makanan yang sesuai dengan kriteria. Coba ubah target kalori atau budget.
                </p>
                <button id="add-selected-foods" class="btn btn-success" style="display: none;">
                    Tambahkan ke Makanan Hari Ini
                </button>
            </div>
        </section>

        <!-- Barcode Scanner Section -->
        <section id="scanner-section" class="card" style="display: none;">
            <div class="card-header">
                <h2>Scan Barcode</h2>
                <span class="scanner-badge">Beta</span>
            </div>
            <p class="section-description">Scan barcode produk makanan untuk otomatis input kalori</p>

            <div id="scanner-controls">
                <button id="start-scanner-btn" class="btn btn-primary">
                    ðŸ“· Buka Scanner
                </button>
            </div>

            <div id="scanner-container" class="scanner-container" style="display: none;">
                <div id="scanner-reader" class="scanner-reader"></div>
                <div class="scanner-info">
                    <p>Arahkan kamera ke barcode produk</p>
                    <p class="text-muted">Mendukung barcode EAN-13, UPC, dan lainnya</p>
                </div>
                <button id="close-scanner-btn" class="btn btn-secondary">
                    Tutup Scanner
                </button>
            </div>

            <!-- Scanner result preview -->
            <div id="scanner-result" class="scanner-result" style="display: none;">
                <h3>Produk Ditemukan</h3>
                <div class="product-preview">
                    <div class="product-info">
                        <h4 id="product-name" class="product-name">-</h4>
                        <p id="product-brand" class="product-brand">-</p>
                    </div>
                    <div class="product-nutrition">
                        <div class="nutrition-item">
                            <span class="nutrition-label">Kalori</span>
                            <span id="product-calories" class="nutrition-value">-</span>
                        </div>
                        <div class="nutrition-item">
                            <span class="nutrition-label">Per</span>
                            <span id="product-portion" class="nutrition-value">100g</span>
                        </div>
                    </div>
                </div>
                <div class="scanner-actions">
                    <button id="add-scanned-food" class="btn btn-success">
                        âœ“ Tambah ke Makanan Hari Ini
                    </button>
                    <button id="cancel-scanned" class="btn btn-secondary">
                        Batal
                    </button>
                </div>
            </div>

            <!-- Manual input fallback -->
            <div id="manual-input-container" class="manual-input" style="display: none;">
                <h3 id="manual-input-title">Produk Tidak Ditemukan</h3>
                <p class="text-muted" id="manual-input-description">Tambahkan informasi produk secara manual</p>
                <div class="form-group">
                    <label for="manual-product-name">Nama Produk</label>
                    <input type="text" id="manual-product-name" placeholder="Nama produk...">
                </div>
                <div class="form-group">
                    <label for="manual-product-calories">Kalori (per 100g)</label>
                    <input type="number" id="manual-product-calories" placeholder="Contoh: 250" min="1">
                </div>
                <div class="scanner-actions">
                    <button id="save-manual-product" class="btn btn-success">
                        Simpan & Tambahkan
                    </button>
                    <button id="cancel-manual" class="btn btn-secondary">
                        Batal
                    </button>
                </div>
            </div>
        </section>

        <!-- Weight Progress Section -->
        <section id="weight-section" class="card" style="display: none;">
            <h2>Progress Berat Badan</h2>

            <!-- Weight Input -->
            <div class="weight-input-row">
                <div class="form-group">
                    <label for="weight-input">Berat Hari Ini (kg)</label>
                    <input type="number" id="weight-input" min="30" max="300" step="0.1" placeholder="65.5">
                </div>
                <button id="add-weight-btn" class="btn btn-primary">Catat</button>
            </div>

            <!-- Weight Stats -->
            <div class="weight-stats" id="weight-stats" style="display: none;">
                <div class="weight-stat-item">
                    <span class="weight-stat-label">Berat Awal</span>
                    <span class="weight-stat-value" id="start-weight">-</span>
                </div>
                <div class="weight-stat-item">
                    <span class="weight-stat-label">Berat Sekarang</span>
                    <span class="weight-stat-value" id="current-weight-display">-</span>
                </div>
                <div class="weight-stat-item highlight">
                    <span class="weight-stat-label">Perubahan</span>
                    <span class="weight-stat-value" id="weight-change">-</span>
                </div>
            </div>

            <!-- Weight Chart (Simple Bar) -->
            <div class="weight-chart" id="weight-chart">
                <h3>Riwayat (7 Hari Terakhir)</h3>
                <div class="chart-container" id="weight-chart-container">
                    <p class="empty-message">Belum ada data berat badan.</p>
                </div>
            </div>
        </section>

        <!-- Body Measurements Section -->
        <section id="measurements-section" class="card" style="display: none;">
            <div class="card-header">
                <h2>Ukuran Tubuh</h2>
                <button id="toggle-measurement-form" class="btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>

            <!-- Measurement Form -->
            <form id="measurement-form" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="waist">Pinggang (cm)</label>
                        <input type="number" id="waist" min="40" max="200" step="0.1" placeholder="80">
                    </div>
                    <div class="form-group">
                        <label for="chest">Dada (cm)</label>
                        <input type="number" id="chest" min="50" max="200" step="0.1" placeholder="95">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="arm">Lengan (cm)</label>
                        <input type="number" id="arm" min="15" max="60" step="0.1" placeholder="30">
                    </div>
                    <div class="form-group">
                        <label for="thigh">Paha (cm)</label>
                        <input type="number" id="thigh" min="30" max="100" step="0.1" placeholder="55">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="hip">Pinggul (cm)</label>
                        <input type="number" id="hip" min="50" max="200" step="0.1" placeholder="95">
                    </div>
                    <div class="form-group">
                        <label for="neck">Leher (cm)</label>
                        <input type="number" id="neck" min="20" max="60" step="0.1" placeholder="38">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Simpan Ukuran</button>
            </form>

            <!-- Measurement Display -->
            <div id="measurement-display" class="measurement-display">
                <p class="empty-message">Belum ada data ukuran tubuh.</p>
            </div>

            <!-- Measurement History -->
            <div id="measurement-history" class="measurement-history" style="display: none;">
                <h3>Riwayat Pengukuran</h3>
                <div id="measurement-history-list"></div>
            </div>
        </section>

        <!-- History Section -->
        <section id="history-section" class="card" style="display: none;">
            <h2>Riwayat Kalori</h2>

            <!-- Calorie History Chart -->
            <div class="history-chart" id="calorie-history-chart">
                <div class="chart-bars" id="calorie-chart-bars">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- History List -->
            <div class="history-list" id="history-list">
                <!-- Generated by JS -->
            </div>
        </section>

        <!-- API Settings Section -->
        <section id="settings-section" class="card settings-card">
            <div class="settings-header" id="settings-toggle">
                <h2>Pengaturan</h2>
                <span class="settings-arrow">â–¼</span>
            </div>
            <div class="settings-content" id="settings-content" style="display: none;">
                <h3>CalorieNinjas API</h3>
                <p class="settings-info">
                    Untuk mencari kalori makanan dari database internasional, masukkan API key dari
                    <a href="https://calorieninjas.com/api" target="_blank">CalorieNinjas</a> (gratis).
                </p>
                <div class="form-group">
                    <label for="api-key">API Key (opsional)</label>
                    <input type="password" id="api-key" placeholder="Masukkan API key...">
                </div>
                <div class="settings-actions">
                    <button id="save-api-key" class="btn btn-primary btn-small">Simpan</button>
                    <button id="clear-api-key" class="btn btn-danger btn-small">Hapus</button>
                </div>
                <p class="api-status" id="api-status"></p>

                <hr class="settings-divider">

                <h3>Reset Data</h3>
                <p class="settings-info">Hapus semua data aplikasi (profil, makanan, berat badan, dll).</p>
                <button id="reset-all-btn" class="btn btn-danger btn-small">Reset Semua Data</button>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>Kcal Calculator &copy; <span id="current-year"></span> | Jaga kesehatanmu!</p>
            <p class="footer-credit">Created by <a href="https://www.linkedin.com/in/muhammad-fatan-najuda-sarwan/"
                    target="_blank">Fatan Najuda</a></p>
        </footer>
        <script>document.getElementById('current-year').textContent = new Date().getFullYear();</script>
    </div>

    <!-- Template Modal -->
    <div id="template-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Simpan sebagai Template</h3>
                <button class="modal-close" id="close-template-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="template-name">Nama Template</label>
                    <input type="text" id="template-name" placeholder="Contoh: Sarapan Sehat">
                </div>
            </div>
            <div class="modal-footer">
                <button id="confirm-save-template" class="btn btn-primary">Simpan</button>
                <button id="cancel-save-template" class="btn btn-secondary">Batal</button>
            </div>
        </div>
    </div>

    <!-- Price Edit Modal -->
    <div id="price-modal" class="modal" style="display: none;">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h3>Edit Harga</h3>
                <button class="modal-close" id="close-price-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p class="price-edit-food-name" id="price-edit-food-name">-</p>
                <div class="form-group">
                    <label for="price-edit-input">Harga (Rp)</label>
                    <input type="number" id="price-edit-input" min="0" step="1000" placeholder="15000">
                </div>
                <p class="price-edit-hint">Harga akan disimpan dan digunakan untuk pencarian berikutnya.</p>
            </div>
            <div class="modal-footer">
                <button id="confirm-price-edit" class="btn btn-primary">Simpan</button>
                <button id="reset-price-edit" class="btn btn-secondary">Reset ke Default</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Confirm Modal -->
    <div id="confirm-modal" class="modal-overlay" style="display: none;">
        <div class="modal confirm-modal">
            <div class="confirm-icon" id="confirm-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
            </div>
            <h3 id="confirm-title" class="confirm-title">Konfirmasi</h3>
            <p id="confirm-message" class="confirm-message">Apakah Anda yakin?</p>
            <div class="confirm-actions">
                <button id="confirm-cancel" class="btn btn-secondary">Batal</button>
                <button id="confirm-ok" class="btn btn-danger">Hapus</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="js/foods-db.js"></script>
    <script src="js/calorie-api.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/calculator.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker Registration & Auto-Update -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered:', registration.scope);

                        // Check for updates every 5 minutes
                        setInterval(() => {
                            registration.update();
                        }, 5 * 60 * 1000);

                        // Listen for new service worker
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('New SW found, installing...');

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    showUpdateNotification();
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('SW registration failed:', error);
                    });

                // Listen for SW messages
                navigator.serviceWorker.addEventListener('message', (event) => {
                    if (event.data.type === 'SW_UPDATED') {
                        console.log('App updated to version:', event.data.version);
                        showUpdateNotification();
                    }
                });
            });

            // Reload when SW takes control
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });
        }

        function showUpdateNotification() {
            // Create update notification element
            const notification = document.createElement('div');
            notification.id = 'update-notification';
            notification.innerHTML = `
                <div style="
                    position: fixed;
                    bottom: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #2ecc71, #27ae60);
                    color: white;
                    padding: 16px 24px;
                    border-radius: 12px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
                    z-index: 10000;
                    display: flex;
                    align-items: center;
                    gap: 16px;
                    font-family: inherit;
                    animation: slideUp 0.3s ease;
                ">
                    <span>Versi baru tersedia!</span>
                    <button onclick="window.location.reload()" style="
                        background: white;
                        color: #27ae60;
                        border: none;
                        padding: 8px 16px;
                        border-radius: 8px;
                        font-weight: bold;
                        cursor: pointer;
                    ">Update</button>
                </div>
            `;

            // Add animation style
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideUp {
                    from { transform: translateX(-50%) translateY(100px); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(notification);
        }
    </script>
</body>

</html>